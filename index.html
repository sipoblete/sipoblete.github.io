<!DOCTYPE html>
<html>
<body>

<meta name="viewport" content="width=device-width, initial-scale=1"> 
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>
<!-- <script type="module" src = "client.js"></script> -->
<link rel='stylesheet' type='text/css' href='index.css'>
<script src="plotly.min.js"></script>
<script type="text/JavaScript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js" ></script>
<script type = "text/javascript">

var socket = io("wss://le-18262636.bitzonte.com", {path: '/stocks'});
var isPaused = false;


function inicio(){

socket.emit("STOCKS");
socket.on('STOCKS', (data) => {
            console.log(data);
            var i = 0;
            for (var i = 0; i < data.length; i++){
			    var obj = data[i];
			    for (var key in obj){
			        var attrName = key;
			        var attrValue = obj[key];
			        if (attrName == 'ticker'){
			        	console.log(attrValue);
			        	 $('#charts').append($('<div/>', { id: attrValue}))
			        	createChart(attrValue);
			        }
    				}

					}
			isPaused=true;
        			});

}

function actualizar(){

	socket.on('UPDATE', (data) => {
	// console.log(data);
	var time = new Date(data.time)
	if (isPaused){
		Plotly.extendTraces(data.ticker,{y:[[data.value]], x:[[time]]},[0]);
	}
        });
	}
	
function main(){
	inicio();
	actualizar();
}

function toggleCheck() {
  if(document.getElementById("boton").checked === false){
    main();
  } else {
  	window.location.reload();
    console.log("para de correr");
  }
}




</script>

<h1>Hello World Line Chart</h1>

<label class="switch">
  <input id= "boton" onclick="toggleCheck()" type="checkbox" checked>
  <span class="slider round"></span>
</label>

<div id="charts">
	

</div>

<script>
	

	function createChart(ticker){
		Plotly.newPlot(ticker, [{
		y: [],
		x: [],
		type:'line',
		line: {color: '#80CAF6'}
	}],{
		title: {
			text: ticker,
			font:{
				family: "Courier New, monospace",
				size: 24,
			},
    	xref: 'paper',
    	x: 0.05,
			},
	  xaxis: {
	    title: {
	      text: 'Time',
	      font: {
	        family: 'Courier New, monospace',
	        size: 18,
	        color: '#7f7f7f'
	      }
	    },
	  },
		  yaxis: {
		    title: {
		      text: 'Value',
		      font: {
		        family: 'Courier New, monospace',
		        size: 18,
		        color: '#7f7f7f'
		      }
		    }
		  }
		
	});
	}


</script>

</body>
</html>

